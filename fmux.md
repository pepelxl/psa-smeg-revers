# Описываются настройки управления магнитолой.
Меню,вкладки, громкость, и т.д. возможно вызвать, только, по can. Исключением является 6 ось(IV2), где реализованы три аналоговых входа для клавиши menu, volume+, volume-.
FMUX является сокрашением от Façade multifonction(многофункциональная лицевая панель). Подключена по can. Представляет собой набор сенсорных или физических кнопок во круг дисплея.
Так же магнитолой можно управлять с кнопок на/под рулём. Кнопки, как правило подключены к bsi по lin.

В файле настроек up-config есть три группы аргументов для настройки поведения магнитолы.
1) Параметр VMF_VCCF задаёт таблицу поведения магнитолы.
2) 9 параметров VMF* 
3) Таблица FMUX_Config содержит 58 битовые маски.

## Кнопки
Магнитола проверяет определённые биты в can пакетах.  
Ниже представлены соответствие битов из прошивки 6.4.A.R20 gateway can2010  
ID 0A2 - нижний блок кнопок(расширеный)  
d1[5],d1[4],d1[3],d1[2],d1[0],d2[7]  
scroll D0 - D1[7-6] биты связаные с колёсиком при переходе через значения 7F-80  
scroll D5 - D4[1-0] биты связаные с колёсиком при переходе через значения 7F-80  
При достижении перехода 7F-80 происходит инверсия соответствующего бита и сброс показания счётчика на 0  

ID 122 - fmux  
d0,d1,d2,d3,d4,d5[7-3]  
scroll D6 - имеет бит защёлку D5[1]  
scroll D7 - имеет бит защёлку D5[0]  
защёлка выставляется отправителем один раз при первой посылке для привязки текущего значения  

ID 221 - подрулевые кнопки  
d0[0],d0[3]  

ID 21F  - вершний блок кнопок(стандартный)  
d0[7],d0[6],d[3],d0[2],d0[3-2],d0[1],d0[0],d2[7],d2[6]  
scroll D1 - D0[5-4] биты связаные с колёсиком при переходе через значения 7F-80  
D0[4] 80->7F , D1 set 0  
D0[5] 7F->80 , D1 set 0  
При достижении перехода 7F-80 происходит инверсия соответствующего бита и сброс показания счётчика на 0  

Четыре пакета выше после определения обрабатываются в зависимости от кодирования магнитолы.  
## FMUX
содержит 58 байт для битовых масок. Каждый байт это команда(инструкция), закреплённая под своим номером. Расположение байта равно биту в последовательности CAN посылки.
Первые 44 байт привязаны к первым пяти с половиной байтам CAN id 0x122.

### Пример FMUX от Citroen с4 picasso
Панель при событии(нажатии на кнопку) шлёт посылку id 0x122 длинной восемь байт.
<code>00 00 00 00 00 02 01 00</code>
где D6 Является энкодором крутилки громкости(00-FF), а D5[1] флагом защёлкой энкодера.
Представляем первые пять байт(D0-D4) в виде битового поля <code>00000000 00000000 00000000 00000000 00000000</code>.
Например, при нажатии на клавишу телефон генерируется 0x122 <code>00 00 08 00 00 00 00 00</code> что равняется <code>00000000 00000000 00001000 00000000 00000000</code>.
Пареметр FMUX_Config для пикассо  
<code>00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 
00 00 00 00 1a 1e 20 22 3a 00 39 38 00 00 00 00 
00 00 00 00 00 00 00 00 00 00 00 00 01 00 00 00 
00 00 00 00 00 00 00 00 00 00 </code>
Соответственно будет выполнена команда 0x1A = отобразить панель телефона и т.д.
Переставляя байты можно привязать любое допустимое действие на любую клавишу, но будте осторожны, посылку id 0x122 слушает не только магнитола. Например D5[3] отключает ESP. 

К чему привязаны последние 18 флагов не известно.
